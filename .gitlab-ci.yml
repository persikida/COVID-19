stages:
  - image
  - deploy
  - undo

image statg:
  stage: image
  image: registry.services.mts.ru/docker-ingame/kaniko:debug-v0.14.0
  only:
    refs:
      - test-branch
      - develop
  before_script:
    - echo "{\"auths\":{\"$CI_REGISTRY\":{\"username\":\"$CI_REGISTRY_USER\",\"password\":\"$CI_REGISTRY_PASSWORD\"}}}" > /kaniko/.docker/config.json
  script:
    - executor --context $CI_PROJECT_DIR/image/ --dockerfile $CI_PROJECT_DIR/image/Dockerfile --destination $CI_REGISTRY_IMAGE:statgames-$CI_COMMIT_REF_NAME-commit-$CI_COMMIT_SHORT_SHA