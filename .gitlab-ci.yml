stages:
  - build
  - image

build statg:
  stage: build
  image: registry.services.mts.ru/docker/nginx/nginx-alpine:1.17.2
  only:
    changes:
      - www/*
    #- .gitlab-ci.yml
    refs:
      - test-branch
      - develop
  artifacts:
    paths:
    - $CI_PROJECT_DIR/build
    expire_in: 1 day
  script:
  - cp -a $CI_PROJECT_DIR/image/nginx.conf /etc/nginx/nginx.conf
  - mkdir /www-data
  - cp -a $CI_PROJECT_DIR/www/* /www-data/

image statg:
  stage: image
  image: registry.services.mts.ru/docker/nginx/nginx-alpine:1.17.2
  only:
    refs:
      - test-branch
  before_script:
    - echo "{\"auths\":{\"$CI_REGISTRY\":{\"username\":\"$CI_REGISTRY_USER\",\"password\":\"$CI_REGISTRY_PASSWORD\"}}}"
  script:
    - echo ls -lah $CI_PROJECT_DIR/build